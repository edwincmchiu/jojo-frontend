[33m8864eac[m[33m ([m[1;31morigin/main[m[33m)[m Merge remote-tracking branch 'origin/feat/profile-auth'
[33m7c6a8e9[m add admin login and register functions
[33m5a21299[m add register and login functions
[33m95912d5[m Merge remote-tracking branch 'origin/feat/profile-auth'
[33mcf85527[m remove unnecessary files
[33me7702e8[m feat: å‰µå»ºæ´»å‹•æ™‚æœƒæª¢æŸ¥user_id
[33mca63fe4[m delete: åˆªé™¤æ‰¾æ´»å‹•é é¢å†—é¤˜çš„çš„emojiè¨­å®š
[33m6956342[m delete:åˆªé™¤fetchVenueAvailabilityçš„api
[33m190fad2[m fix: å¯ä»¥ç”¨admin/admin123å¸³å¯†ç™»å…¥ç®¡ç†ä»‹é¢
[33mebffd63[m merge
[33mbe822ae[m feat:æ–°å¢ç®¡ç†ä»‹é¢
[1mdiff --git a/src/features/profile/UserProfile.jsx b/src/features/profile/UserProfile.jsx[m
[1mindex b26b886..6772d42 100644[m
[1m--- a/src/features/profile/UserProfile.jsx[m
[1m+++ b/src/features/profile/UserProfile.jsx[m
[36m@@ -1,29 +1,36 @@[m
 import { useState, useEffect } from 'react';[m
 import { fetchUserProfile, addPreference, removePreference } from '../../api/profile';[m
[31m-import axios from 'axios';[m
 [m
[31m-export default function UserProfile({userId}) {[m
[32m+[m[32mexport default function UserProfile({ userId }) {[m
   const [user, setUser] = useState(null);[m
   const [loading, setLoading] = useState(true);[m
[31m-  const [activeTab, setActiveTab] = useState('joined'); // 'joined' æˆ– 'hosted'[m
[32m+[m[32m  const [activeTab, setActiveTab] = useState('joined'); // 'joined' or 'hosted'[m
 [m
   const [isAddingTag, setIsAddingTag] = useState(false);[m
   const [selectedTag, setSelectedTag] = useState('');[m
[31m-  // æ¨™æº–æ¨™ç±¤æ¸…å–® (å»ºè­°æœªä¾†å¾å¾Œç«¯ API ç²å–ï¼Œé€™è£¡æš«æ™‚ç¡¬ç·¨ç¢¼)[m
   const AVAILABLE_TAGS = ["é‹å‹•", "è®€æ›¸", "é›»å½±", "å®µå¤œ", "æˆ¶å¤–", "æ¡ŒéŠ", "Coding", "æ”å½±", "éŸ³æ¨‚", "ç¾é£Ÿ"];[m
 [m
[31m-  // 1. å–å¾—ä½¿ç”¨è€…è³‡æ–™[m
   useEffect(() => {[m
[31m-    if (userId){ Â [m
[31m-        fetchUserProfile(userId).then(data => {[m
[31m-        setUser(data);[m
[31m-        setLoading(false);[m
[31m-      });}[m
[32m+[m[32m    if (!userId) return;[m
[32m+[m[32m    let mounted = true;[m
[32m+[m[32m    fetchUserProfile(userId)[m
[32m+[m[32m      .then(data => {[m
[32m+[m[32m        if (mounted) {[m
[32m+[m[32m          setUser(data || {});[m
[32m+[m[32m          setLoading(false);[m
[32m+[m[32m        }[m
[32m+[m[32m      })[m
[32m+[m[32m      .catch(() => {[m
[32m+[m[32m        if (mounted) {[m
[32m+[m[32m          setUser({});[m
[32m+[m[32m          setLoading(false);[m
[32m+[m[32m        }[m
[32m+[m[32m      });[m
[32m+[m[32m    return () => { mounted = false; };[m
   }, [userId]);[m
[31m-  [m
[31m-  // 2. æ–°å¢èˆˆè¶£æ¨™ç±¤é‚è¼¯[m
[32m+[m
   const handleAddInterest = async () => {[m
[31m-    if (!selectedTag) return;[m
[32m+[m[32m    if (!selectedTag || !user?.id) return;[m
     try {[m
       await addPreference(user.id, selectedTag);[m
       setUser(prev => ({[m
[36m@@ -35,10 +42,10 @@[m [mexport default function UserProfile({userId}) {[m
     } catch (err) {[m
       console.error('Error adding preference: ', err);[m
     }[m
[31m-  }[m
[32m+[m[32m  };[m
 [m
[31m-  // 3. ç§»é™¤èˆˆè¶£æ¨™ç±¤é‚è¼¯[m
   const handleRemoveInterest = async (typeNameToRemove) => {[m
[32m+[m[32m    if (!typeNameToRemove || !user?.id) return;[m
     try {[m
       await removePreference(user.id, typeNameToRemove);[m
       setUser(prev => ({[m
[36m@@ -57,36 +64,34 @@[m [mexport default function UserProfile({userId}) {[m
 [m
   return ([m
     <div className="animate-fade-in bg-gray-50 min-h-full">[m
[31m-      [m
[31m-      {/* 1. Header & åŸºæœ¬è³‡æ–™ (USER Table) */}[m
       <div className="bg-white p-8 pb-10 shadow-sm mb-6">[m
         <div className="flex flex-col items-center">[m
           <div className="w-24 h-24 bg-brand-yellow rounded-full flex items-center justify-center text-5xl shadow-md border-4 border-white mb-4">[m
[31m-            {user.avatar}[m
[32m+[m[32m            {user?.avatar}[m
           </div>[m
[31m-          <h2 className="text-2xl font-bold text-gray-800">{user.name}</h2>[m
[31m-          <p className="text-gray-500 text-sm mb-4">{user.email}</p>[m
[32m+[m[32m          <h2 className="text-2xl font-bold text-gray-800">{user?.name ?? 'ä½¿ç”¨è€…'}</h2>[m
[32m+[m[32m          <p className="text-gray-500 text-sm mb-4">{user?.email ?? ''}</p>[m
 [m
[31m-          {/* 2. ç¾¤çµ„æ¨™ç±¤ (USER_GROUP Table) */}[m
           <div className="flex flex-wrap justify-center gap-2 mb-4">[m
[31m-            {user.groups.map(g => ([m
[31m-              <span key={g.id} className="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-bold border border-blue-100">[m
[31m-                {g.type === 'Dorm' ? 'ğŸ ' : 'ğŸ“'} {g.name}[m
[32m+[m[32m            {user?.groups?.map((g, idx) => ([m
[32m+[m[32m              <span[m
[32m+[m[32m                key={g?.id ?? g?.Group_id ?? g?.name ?? `group-${idx}`}[m
[32m+[m[32m                className="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-bold border border-blue-100"[m
[32m+[m[32m              >[m
[32m+[m[32m                {g?.type === 'Dorm' ? 'ğŸ ' : 'ğŸ“'} {g?.name}[m
               </span>[m
             ))}[m
           </div>[m
 [m
[31m-          {/* 3. èˆˆè¶£æ¨™ç±¤ (PREFERENCE Table) */}[m
           <div className="flex flex-wrap justify-center gap-2">[m
[31m-            [m
[31m-            {/* é¡¯ç¤ºå·²æœ‰çš„èˆˆè¶£æ¨™ç±¤ (è®Šæˆå¯ç§»é™¤çš„æŒ‰éˆ•) */}[m
             {user?.interests?.map((interest, idx) => {[m
               const label = typeof interest === 'string'[m
                 ? interest[m
                 : (interest?.Type_name ?? interest?.type_name ?? interest?.name ?? `interest-${idx}`);[m
[32m+[m[32m              const key = label ?? `interest-${idx}`;[m
               return ([m
                 <span[m
[31m-                  key={`${label}-${idx}`}[m
[32m+[m[32m                  key={key}[m
                   onClick={() => handleRemoveInterest(label)}[m
                   className="px-2 py-1 bg-gray-100 text-gray-600 rounded-lg text-xs flex items-center gap-1 font-medium hover:bg-red-100 hover:text-red-600 transition-colors cursor-pointer"[m
                 >[m
[36m@@ -95,8 +100,7 @@[m [mexport default function UserProfile({userId}) {[m
                 </span>[m
               );[m
             })}[m
[31m-            [m
[31m-            {/* é—œéµçš„æ¢ä»¶æ¸²æŸ“é‚è¼¯ï¼šæ–°å¢æ¨™ç±¤é¸å–® */}[m
[32m+[m
             {isAddingTag ? ([m
               <div className="flex gap-2 items-center">[m
                 <select[m
[36m@@ -106,22 +110,24 @@[m [mexport default function UserProfile({userId}) {[m
                 >[m
                   <option value="">é¸æ“‡èˆˆè¶£...</option>[m
                   {AVAILABLE_TAGS[m
[31m-                      .filter(tag => !user.interests.includes(tag))[m
[31m-                      .map(tag => ([m
[31m-                          <option key={tag} value={tag}>{tag}</option>[m
[31m-                  ))}[m
[32m+[m[32m                    .filter(tag => !(user?.interests || []).some(i => {[m
[32m+[m[32m                      const name = typeof i === 'string' ? i : (i?.Type_name ?? i?.type_name ?? i?.name);[m
[32m+[m[32m                      return name === tag;[m
[32m+[m[32m                    }))[m
[32m+[m[32m                    .map(tag => ([m
[32m+[m[32m                      <option key={tag} value={tag}>{tag}</option>[m
[32m+[m[32m                    ))}[m
                 </select>[m
[31m-                [m
[31m-                {/* å„²å­˜æŒ‰éˆ• */}[m
[31m-                <button [m
[31m-                  onClick={handleAddInterest} [m
[31m-                  disabled={!selectedTag} [m
[32m+[m
[32m+[m[32m                <button[m
[32m+[m[32m                  onClick={handleAddInterest}[m
[32m+[m[32m                  disabled={!selectedTag}[m
                   className="px-2 py-1 bg-brand-yellow text-brand-dark rounded-lg text-xs font-bold disabled:opacity-50"[m
                 >[m
                   å„²å­˜[m
                 </button>[m
[31m-                [m
[31m-                <button [m
[32m+[m
[32m+[m[32m                <button[m
                   onClick={() => setIsAddingTag(false)}[m
                   className="px-2 py-1 text-gray-500 rounded-lg text-xs"[m
                 >[m
[36m@@ -129,9 +135,8 @@[m [mexport default function UserProfile({userId}) {[m
                 </button>[m
               </div>[m
             ) : ([m
[31m-              // å¦å‰‡é¡¯ç¤ºåŸæœ¬çš„ +æ–°å¢æŒ‰éˆ•[m
[31m-              <button [m
[31m-                onClick={() => setIsAddingTag(true)} [m
[32m+[m[32m              <button[m
[32m+[m[32m                onClick={() => setIsAddingTag(true)}[m
                 className="px-3 py-1 border border-dashed border-gray-300 text-gray-400 rounded-lg text-xs hover:bg-gray-50"[m
               >[m
                 + æ–°å¢[m
[36m@@ -141,19 +146,17 @@[m [mexport default function UserProfile({userId}) {[m
         </div>[m
       </div>[m
 [m
[31m-      {/* 4. æ´»å‹•ç´€éŒ„ (EVENT & JOIN_RECORD Tables) */}[m
       <div className="px-8 max-w-4xl mx-auto">[m
         <h3 className="font-bold text-2xl text-gray-800 mb-4">æˆ‘çš„æ´»å‹•ç´€éŒ„</h3>[m
[31m-        [m
[31m-        {/* Tab Switcher */}[m
[32m+[m
         <div className="flex bg-gray-200 p-1 rounded-xl mb-4">[m
[31m-          <button [m
[32m+[m[32m          <button[m
             onClick={() => setActiveTab('joined')}[m
             className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${activeTab === 'joined' ? 'bg-white shadow text-brand-dark' : 'text-gray-500'}`}[m
           >[m
             æˆ‘åƒåŠ çš„[m
           </button>[m
[31m-          <button [m
[32m+[m[32m          <button[m
             onClick={() => setActiveTab('hosted')}[m
             className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${activeTab === 'hosted' ? 'bg-white shadow text-brand-dark' : 'text-gray-500'}`}[m
           >[m
[36m@@ -161,35 +164,25 @@[m [mexport default function UserProfile({userId}) {[m
           </button>[m
         </div>[m
 [m
[31m-        {/* List Content */}[m
         <div className="space-y-3">[m
[31m-          {(activeTab === 'joined' ? user.joinedEvents : user.hostedEvents)?.map((ev) => ([m
[31m-            <div key={ev?.id ?? `event-${Math.random()}`} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center">[m
[32m+[m[32m          {(activeTab === 'joined' ? user?.joinedEvents : user?.hostedEvents)?.map((ev, idx) => ([m
[32m+[m[32m            <div key={ev?.id ?? ev?.Event_id ?? `event-${idx}`} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center">[m
               <div>[m
[31m-                <h4 className="font-bold text-gray-800">{ev.title}</h4>[m
[32m+[m[32m                <h4 className="font-bold text-gray-800">{ev?.title}</h4>[m
                 <div className="text-xs text-gray-500 mt-1">[m
[31m-                  <span>ğŸ“… {ev.startTime}</span>[m
[32m+[m[32m                  <span>ğŸ“… {ev?.startTime}</span>[m
                 </div>[m
               </div>[m
             </div>[m
           ))}[m
 [m
[31m-          {(activeTab === 'hosted' && user.hostedEvents.length === 0) && ([m
[31m-             <div className="text-center py-8 text-gray-400 text-sm">[m
[31m-                ä½ é‚„æ²’æœ‰èˆ‰è¾¦éæ´»å‹•å–”ï¼<br/>è¶•å¿«æŒ‰ã€Œé–‹åœ˜ã€è©¦è©¦çœ‹å§ï¼[m
[31m-             </div>[m
[32m+[m[32m          {(activeTab === 'hosted' && (user?.hostedEvents || []).length === 0) && ([m
[32m+[m[32m            <div className="text-center py-8 text-gray-400 text-sm">[m
[32m+[m[32m              ä½ é‚„æ²’æœ‰èˆ‰è¾¦éæ´»å‹•å–”ï¼<br />è¶•å¿«æŒ‰ã€Œé–‹åœ˜ã€è©¦è©¦çœ‹å§ï¼[m
[32m+[m[32m            </div>[m
           )}[m
         </div>[m
       </div>[m
[31m-      [m
[31m-      {/* Logout Button[m
[31m-      <div className="px-6 mt-8">[m
[31m-        <button className="w-full py-3 border border-red-200 text-red-500 rounded-xl font-bold hover:bg-red-50 transition-all">[m
[31m-          ç™»å‡ºå¸³è™Ÿ[m
[31m-        </button>[m
[31m-        <p className="text-center text-xs text-gray-300 mt-4">JoJo v1.0.0 (Build 20251128)</p>[m
[31m-      </div> */}[m
[31m-[m
     </div>[m
   );[m
 }[m
\ No newline at end of file[m
